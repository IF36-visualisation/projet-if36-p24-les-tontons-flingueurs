---
title: "Projet IF36"
author: "Les Tontons Flingueurs"
date: "2024-06-10"
output:
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

![](https://i.imgur.com/tPHIgmR.png)

```{r setup2, echo=FALSE, include=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(tibble)
library(gridExtra)
library("viridis")
library(ggcorrplot)
library(FactoMineR)
library(factoextra)
df <- read_csv("data/mxmh_survey_results.csv", show_col_types = FALSE)
frequency_columns <- colnames(df)[grep("^Frequency", colnames(df))]
remove_frequency_prefix <- function(dataframe) {
  mapper <- function(col_name) {
    col_name <- sub("^Frequency \\[", "", col_name)
    sub("]$", "", col_name)
  }
  colnames(dataframe) <- sapply(colnames(dataframe), mapper)
  return(dataframe)
}

```


### 1) Y a-t-il des différences notables dans les scores de troubles mentaux ou les heures d'écoute par jour en fonction de la plateforme de streaming principale utilisée (Primary streaming) ?

<br>

#### **Analyse**

Pour répondre à cette question, nous allons comparer les scores de troubles mentaux et les heures d'écoute par jour en fonction de la plateforme de streaming principale utilisée. Nous allons commencer par visualiser les données pour mieux les comprendre.

<br>

```{r, echo=FALSE}
# Heures d'écoutes en fonction de la plateforme de streaming

df_outliers <- df %>% filter(!is.na(`Primary streaming service`))

df_outliers_platform <- df_outliers %>% 
  group_by(`Primary streaming service`) %>% 
  summarise(mean_heures_ecoute = mean(`Hours per day`, na.rm = TRUE),
            nb_heures_ecoute = n(),
            mean_Depression = mean(Depression, na.rm = TRUE),
            mean_Anxiety = mean(Anxiety, na.rm = TRUE),
            mean_Insomnia = mean(Insomnia, na.rm = TRUE),
            mean_OCD = mean(OCD, na.rm = TRUE))

df_outliers_platform$`Primary streaming service` <- factor(df_outliers_platform$`Primary streaming service`, levels = c("Spotify", "Apple Music", "Pandora", "YouTube Music", "Other streaming service", "I do not use a streaming service."), labels = c("Spotify", "Apple Music", "Pandora", "YouTube Music", "Autre service de streaming", "Je n'utilise pas de service de streaming."))

plot_heures_ecoute_platform <- ggplot(df_outliers_platform, aes(x = `Primary streaming service`, y = mean_heures_ecoute)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Plateforme de streaming principale", y = "Heures d'écoute par jour", 
       title = "Heures d'écoute par jour en fonction de la plateforme de streaming principale") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Heures d'écoute par jour", direction = -1)

# Scores de troubles mentaux en fonction de la plateforme de streaming

plot_Depression_platform <- ggplot(df_outliers_platform, aes(x = `Primary streaming service`, y = mean_Depression)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Plateforme de streaming principale", y = "Score moyen de dépression", 
       title = "Score moyen de dépression en fonction de la plateforme de streaming principale") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

plot_Anxiety_platform <- ggplot(df_outliers_platform, aes(x = `Primary streaming service`, y = mean_Anxiety)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Plateforme de streaming principale", y = "Score moyen d'anxiété", 
       title = "Score moyen d'anxiété en fonction de la plateforme de streaming principale") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

plot_Insomnia_platform <- ggplot(df_outliers_platform, aes(x = `Primary streaming service`, y = mean_Insomnia)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Plateforme de streaming principale", y = "Score moyen d'insomnie", 
       title = "Score moyen d'insomnie en fonction de la plateforme de streaming principale") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

plot_OCD_platform <- ggplot(df_outliers_platform, aes(x = `Primary streaming service`, y = mean_OCD)) + 
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Plateforme de streaming principale", y = "Score moyen d'OCD", 
       title = "Score moyen d'OCD en fonction de la plateforme de streaming principale") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

combined_plot_platform <- grid.arrange(plot_Depression_platform, plot_Anxiety_platform, plot_Insomnia_platform, plot_OCD_platform, ncol = 1)
  
print(plot_heures_ecoute_platform)
print(combined_plot_platform)
```

#### **Conclusion**



<br>

### 22) Comment les scores d'anxiété, de dépression, d'insomnie et d'OCD sont-ils corrélés entre eux ?

<br>

#### **Analyse**


<br>

```{r, echo=FALSE}
# Corrélation entre les scores de troubles mentaux

df_correlation <- df %>% 
  select(Depression, Anxiety, Insomnia, OCD) %>% 
  cor()

plot_correlation <- ggcorrplot(df_correlation, lab = TRUE, type = "lower", title = "Corrélation entre les scores de troubles mentaux")

print(plot_correlation)
```

#### **Conclusion**

<br>

### 23) Les différentes tranches d'âge écoutent-elles plus ou moins de musique en langue étrangère ?

<br>

#### **Analyse**


<br>

```{r, echo=FALSE}
# Heures d'écoute de musique en langue étrangère en fonction de la tranche d'âge
# 

df_child <- df %>% filter(Age < 18)
df_young <- df %>% filter(Age >= 18 & Age < 31)
df_adult <- df %>% filter(Age >= 31 & Age < 51)
df_senior <- df %>% filter(Age >= 51)

# plot of the % total of foreign music listened by age group ("Enfant (-18 ans)", "Jeune (18-30 ans)", "Adulte (31-50 ans)", "Senior (51+ ans)") so there must be 4 bars (one per age group) and each bar must be divided in 2 parts (one for the % of foreign music listened and one for the % of french music listened) using the fill aesthetic
# Note that age is currently a numeric variable, you will need to create a new variable "age_group" that will be a factor with the 4 levels "Enfant (-18 ans)", "Jeune (18-30 ans)", "Adulte (31-50 ans)", "Senior (51+ ans)" and use this new variable in the x aesthetic and foreign languages is either Yes or No

df_child$age_group <- "Enfant (-18 ans)"
df_young$age_group <- "Jeune (18-30 ans)"
df_adult$age_group <- "Adulte (31-50 ans)"
df_senior$age_group <- "Senior (51+ ans)"

df_age <- rbind(df_child, df_young, df_adult, df_senior)

df_age <- df_age %>% group_by(age_group)

df_age$age_group <- factor(df_age$age_group, levels = c("Enfant (-18 ans)", "Jeune (18-30 ans)", "Adulte (31-50 ans)", "Senior (51+ ans)"))

ggplot(df_age, aes(x = age_group, fill = `Foreign languages`)) +
  geom_bar(position = "fill") +
  labs(x = "Tranche d'âge", y = "Pourcentage total de musique écoutée", 
       title = "Pourcentage total de musique écoutée en langue étrangère en fonction de la tranche d'âge")
```

#### **Conclusion**

<br>