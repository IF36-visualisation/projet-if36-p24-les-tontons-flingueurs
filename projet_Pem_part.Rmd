---
title: "projet"
author: "Pem"
date: "2024-05-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(tibble)
library(gridExtra)
library("viridis")
df <- read.csv("mxmh_survey_results.csv")
```

```{r}
df_fav_genre_Depression <- df %>%
  group_by(Fav.genre, Depression) %>%
  summarise(nb_total = n()) %>%
  spread(key = Depression, value = nb_total, fill = 0)

names(df_fav_genre_Depression)[-1] <- paste0("nb_Depression", colnames(df_fav_genre_Depression)[-1])
nb_total_Malade = rowSums(df_fav_genre_Depression[-1])
df_fav_genre_Depression$nb_total_Malade <- nb_total_Malade
df_fav_genre_Depression <- df_fav_genre_Depression %>% rename(Fav.genre_Depression = Fav.genre)

#print(df_fav_genre_Depression)


plot_Depression <- ggplot(df_fav_genre_Depression, aes(x = Fav.genre_Depression)) +
  geom_col(aes(y = nb_Depression10 + nb_Depression9 + nb_Depression8 + nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_Depression9 + nb_Depression8 + nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_Depression8 + nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 3.5), position = "identity") +
  geom_col(aes(y = nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_Depression1 + nb_Depression0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_Depression0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Nombre de personnes par niveau de dépression", 
       title = "Relation entre le style de musique préféré et la dépression") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau de dépression", direction = -1)



df_fav_genre_Anxiety <- df %>%
  group_by(Fav.genre, Anxiety) %>%
  summarise(nb_total = n()) %>%
  spread(key = Anxiety, value = nb_total, fill = 0)

names(df_fav_genre_Anxiety)[-1] <- paste0("nb_Anxiety", colnames(df_fav_genre_Anxiety)[-1])
nb_total_Malade = rowSums(df_fav_genre_Anxiety[-1])
df_fav_genre_Anxiety$nb_total_Malade <- nb_total_Malade
df_fav_genre_Anxiety <- df_fav_genre_Anxiety %>% rename(Fav.genre_Anxiety = Fav.genre)

#print(df_fav_genre_Anxiety)


plot_Anxiety <- ggplot(df_fav_genre_Anxiety, aes(x = Fav.genre_Anxiety)) +
  geom_col(aes(y = nb_Anxiety10 + nb_Anxiety9 + nb_Anxiety8 + nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_Anxiety9 + nb_Anxiety8 + nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_Anxiety8 + nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 7.5), position = "identity") +
  geom_col(aes(y = nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_Anxiety1 + nb_Anxiety0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_Anxiety0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Nombre de personnes par niveau d'anxiété", 
       title = "Relation entre le style de musique préféré et l'anxiété") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau d'anxiété", direction = -1)



df_fav_genre_Insomnia <- df %>%
  group_by(Fav.genre, Insomnia) %>%
  summarise(nb_total = n()) %>%
  spread(key = Insomnia, value = nb_total, fill = 0)

names(df_fav_genre_Insomnia)[-1] <- paste0("nb_Insomnia", colnames(df_fav_genre_Insomnia)[-1])
nb_total_Malade = rowSums(df_fav_genre_Insomnia[-1])
df_fav_genre_Insomnia$nb_total_Malade <- nb_total_Malade
df_fav_genre_Insomnia <- df_fav_genre_Insomnia %>% rename(Fav.genre_Insomnia = Fav.genre)

#print(df_fav_genre_Insomnia)


plot_Insomnia <- ggplot(df_fav_genre_Insomnia, aes(x = Fav.genre_Insomnia)) +
  geom_col(aes(y = nb_Insomnia10 + nb_Insomnia9 + nb_Insomnia8 + nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_Insomnia9 + nb_Insomnia8 + nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_Insomnia8 + nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 3.5), position = "identity") +
  geom_col(aes(y = nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_Insomnia1 + nb_Insomnia0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_Insomnia0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Nombre de personnes par niveau d'insomnie", 
       title = "Relation entre le style de musique préféré et l'insomnie") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau d'Insomnie", direction = -1)



df_fav_genre_OCD <- df %>%
  group_by(Fav.genre, OCD) %>%
  summarise(nb_total = n()) %>%
  spread(key = OCD, value = nb_total, fill = 0)

names(df_fav_genre_OCD)[-1] <- paste0("nb_OCD", colnames(df_fav_genre_OCD)[-1])
nb_total_Malade = rowSums(df_fav_genre_OCD[-1])
df_fav_genre_OCD$nb_total_Malade <- nb_total_Malade
print(colnames(df_fav_genre_OCD))
df_fav_genre_OCD <- df_fav_genre_OCD %>% rename(Fav.genre_OCD = Fav.genre)

#print(df_fav_genre_OCD)


plot_OCD <- ggplot(df_fav_genre_OCD, aes(x = Fav.genre_OCD)) +
  geom_col(aes(y = nb_OCD10 + nb_OCD9 + nb_OCD8.5 + nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_OCD9 + nb_OCD8.5 + nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_OCD8.5 + nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 8.5), position = "identity") +
  geom_col(aes(y = nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 5.5), position = "identity") +
  geom_col(aes(y = nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_OCD1 + nb_OCD0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_OCD0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Nombre de personnes par niveau d'OCD", 
       title = "Relation entre le style de musique préféré et l'OCD") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau d'OCD", direction = -1)
```

La question que l'on se pose est la suivante : Existe-t-il une corrélation entre le style favori d'une personne et sa santé mentale ? La réponse qui nous viendrait comme cela serait oui, car il semble logique de faire le lien entre "avoir comme style favori un style plutôt lent/calme" et "avoir des problèmes de santé mentale".

Pour vérifier cela, observons d'abords pour chaque style de musique le nombre de personnes qui l'ont en favori ainsi que leur niveau auto-évalué de dépression, d'anxiété, d'insomnie et d'OCD. A savoir que les échelles sont continues car certains se sont évalués l'insomnie et la dépression à 3.5, alors que d'autres se sont évalués l'OCD à 5.5 ou 8.5 et l'anxiété à 7.5. Garder une échelle discrète rendrait ainsi bien moins simple la comparaison entre les 4 graphiques, l'échelle variant d'un graphique à un autre.

```{r, fig.height=15, fig.width=10}
combined_plot <- grid.arrange(plot_Depression, plot_Anxiety, plot_Insomnia, plot_OCD, ncol = 1)
```

La première chose que nous remarquons est que certains styles de musiques sont bien moins populaires que d'autres, et cela peut avoir un impact sur la fiabilité des conclusions qu'on pourra tirés, des styles comme le Latino, le Lofi ou encore le Gospel n'ayant que des échantillons très réduit de personnes les représentant.
La deuxième chose notable est la prévalence des différents problèmes mentaux, qui du plus prévalent au moins prévalent semblent être l'anxiété, la dépression, l'insomnie et enfin l'OCD. Mais difficile de conclure avec assurance ici.

Il nous est au final complexe de conclure quoique ce soit d'autre avec de tels graphiques, les grandes différences de taille d'échantillon rendant les différents styles difficilement comparable. Il nous faut donc aller plus en loin en regardant plutôt les proportions par rapport à chaque échantillon global de chaque style au lieu des nombres bruts.

```{r}
df_fav_genre_Depression_prop <- df_fav_genre_Depression %>%
  mutate(nb_Depression0 = nb_Depression0 / nb_total_Malade * 100,
         nb_Depression1 = nb_Depression1 / nb_total_Malade * 100,
         nb_Depression2 = nb_Depression2 / nb_total_Malade * 100,
         nb_Depression3 = nb_Depression3 / nb_total_Malade * 100,
         nb_Depression3.5 = nb_Depression3.5 / nb_total_Malade * 100,
         nb_Depression4 = nb_Depression4 / nb_total_Malade * 100,
         nb_Depression5 = nb_Depression5 / nb_total_Malade * 100,
         nb_Depression6 = nb_Depression6 / nb_total_Malade * 100,
         nb_Depression7 = nb_Depression7 / nb_total_Malade * 100,
         nb_Depression8 = nb_Depression8 / nb_total_Malade * 100,
         nb_Depression9 = nb_Depression9 / nb_total_Malade * 100,
         nb_Depression10 = nb_Depression10 / nb_total_Malade * 100)

plot_Depression_prop <- ggplot(df_fav_genre_Depression_prop, aes(x = Fav.genre_Depression)) +
  geom_col(aes(y = nb_Depression10 + nb_Depression9 + nb_Depression8 + nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_Depression9 + nb_Depression8 + nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_Depression8 + nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_Depression7 + nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_Depression6 + nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_Depression5 + nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_Depression4 + nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_Depression3.5 + nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 3.5), position = "identity") +
  geom_col(aes(y = nb_Depression3 + nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_Depression2 + nb_Depression1 + nb_Depression0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_Depression1 + nb_Depression0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_Depression0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Proportion (%) de personnes par niveau de dépression", 
       title = "Relation entre le style de musique préféré et la dépression") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau de dépression", direction = -1)



df_fav_genre_Anxiety_prop <- df_fav_genre_Anxiety %>%
  mutate(nb_Anxiety0 = nb_Anxiety0 / nb_total_Malade * 100,
         nb_Anxiety1 = nb_Anxiety1 / nb_total_Malade * 100,
         nb_Anxiety2 = nb_Anxiety2 / nb_total_Malade * 100,
         nb_Anxiety3 = nb_Anxiety3 / nb_total_Malade * 100,
         nb_Anxiety4 = nb_Anxiety4 / nb_total_Malade * 100,
         nb_Anxiety5 = nb_Anxiety5 / nb_total_Malade * 100,
         nb_Anxiety6 = nb_Anxiety6 / nb_total_Malade * 100,
         nb_Anxiety7 = nb_Anxiety7 / nb_total_Malade * 100,
         nb_Anxiety7.5 = nb_Anxiety7.5 / nb_total_Malade * 100,
         nb_Anxiety8 = nb_Anxiety8 / nb_total_Malade * 100,
         nb_Anxiety9 = nb_Anxiety9 / nb_total_Malade * 100,
         nb_Anxiety10 = nb_Anxiety10 / nb_total_Malade * 100)


plot_Anxiety_prop <- ggplot(df_fav_genre_Anxiety_prop, aes(x = Fav.genre_Anxiety)) +
  geom_col(aes(y = nb_Anxiety10 + nb_Anxiety9 + nb_Anxiety8 + nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_Anxiety9 + nb_Anxiety8 + nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_Anxiety8 + nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_Anxiety7.5 + nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 7.5), position = "identity") +
  geom_col(aes(y = nb_Anxiety7 + nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_Anxiety6 + nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_Anxiety5 + nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_Anxiety4 + nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_Anxiety3 + nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_Anxiety2 + nb_Anxiety1 + nb_Anxiety0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_Anxiety1 + nb_Anxiety0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_Anxiety0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Proportion (%) de personnes par niveau d'anxiété", 
       title = "Relation entre le style de musique préféré et l'anxiété") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau d'anxiété", direction = -1)



df_fav_genre_Insomnia_prop <- df_fav_genre_Insomnia %>%
  mutate(nb_Insomnia0 = nb_Insomnia0 / nb_total_Malade * 100,
         nb_Insomnia1 = nb_Insomnia1 / nb_total_Malade * 100,
         nb_Insomnia2 = nb_Insomnia2 / nb_total_Malade * 100,
         nb_Insomnia3 = nb_Insomnia3 / nb_total_Malade * 100,
         nb_Insomnia3.5 = nb_Insomnia3.5 / nb_total_Malade * 100,
         nb_Insomnia4 = nb_Insomnia4 / nb_total_Malade * 100,
         nb_Insomnia5 = nb_Insomnia5 / nb_total_Malade * 100,
         nb_Insomnia6 = nb_Insomnia6 / nb_total_Malade * 100,
         nb_Insomnia7 = nb_Insomnia7 / nb_total_Malade * 100,
         nb_Insomnia8 = nb_Insomnia8 / nb_total_Malade * 100,
         nb_Insomnia9 = nb_Insomnia9 / nb_total_Malade * 100,
         nb_Insomnia10 = nb_Insomnia10 / nb_total_Malade * 100)


plot_Insomnia_prop <- ggplot(df_fav_genre_Insomnia_prop, aes(x = Fav.genre_Insomnia)) +
  geom_col(aes(y = nb_Insomnia10 + nb_Insomnia9 + nb_Insomnia8 + nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_Insomnia9 + nb_Insomnia8 + nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_Insomnia8 + nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_Insomnia7 + nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_Insomnia6 + nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_Insomnia5 + nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_Insomnia4 + nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_Insomnia3.5 + nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 3.5), position = "identity") +
  geom_col(aes(y = nb_Insomnia3 + nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_Insomnia2 + nb_Insomnia1 + nb_Insomnia0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_Insomnia1 + nb_Insomnia0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_Insomnia0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Proportion (%) de personnes par niveau d'insomnie", 
       title = "Relation entre le style de musique préféré et l'insomnie") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau d'Insomnie", direction = -1)



df_fav_genre_OCD_prop <- df_fav_genre_OCD %>%
  mutate(nb_OCD0 = nb_OCD0 / nb_total_Malade * 100,
         nb_OCD1 = nb_OCD1 / nb_total_Malade * 100,
         nb_OCD2 = nb_OCD2 / nb_total_Malade * 100,
         nb_OCD3 = nb_OCD3 / nb_total_Malade * 100,
         nb_OCD4 = nb_OCD4 / nb_total_Malade * 100,
         nb_OCD5 = nb_OCD5 / nb_total_Malade * 100,
         nb_OCD5.5 = nb_OCD5.5 / nb_total_Malade * 100,
         nb_OCD6 = nb_OCD6 / nb_total_Malade * 100,
         nb_OCD7 = nb_OCD7 / nb_total_Malade * 100,
         nb_OCD8 = nb_OCD8 / nb_total_Malade * 100,
         nb_OCD8.5 = nb_OCD8.5 / nb_total_Malade * 100,
         nb_OCD9 = nb_OCD9 / nb_total_Malade * 100,
         nb_OCD10 = nb_OCD10 / nb_total_Malade * 100)


plot_OCD_prop <- ggplot(df_fav_genre_OCD_prop, aes(x = Fav.genre_OCD)) +
  geom_col(aes(y = nb_OCD10 + nb_OCD9 + nb_OCD8.5 + nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 10), position = "identity") +
  geom_col(aes(y = nb_OCD9 + nb_OCD8.5 + nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 9), position = "identity") +
  geom_col(aes(y = nb_OCD8.5 + nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 8.5), position = "identity") +
  geom_col(aes(y = nb_OCD8 + nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 8), position = "identity") +
  geom_col(aes(y = nb_OCD7 + nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 7), position = "identity") +
  geom_col(aes(y = nb_OCD6 + nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 6), position = "identity") +
  geom_col(aes(y = nb_OCD5.5 + nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 5.5), position = "identity") +
  geom_col(aes(y = nb_OCD5 + nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 5), position = "identity") +
  geom_col(aes(y = nb_OCD4 + nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 4), position = "identity") +
  geom_col(aes(y = nb_OCD3 + nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 3), position = "identity") +
  geom_col(aes(y = nb_OCD2 + nb_OCD1 + nb_OCD0, fill = 2), position = "identity") +
  geom_col(aes(y = nb_OCD1 + nb_OCD0, fill = 1), position = "identity") + 
  geom_col(aes(y = nb_OCD0, fill = 0), position = "identity") + 
  labs(x = "Style de musique préféré", y = "Proportion (%) de personnes par niveau d'OCD", 
       title = "Relation entre le style de musique préféré et l'OCD") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_viridis(name = "Niveau d'OCD", direction = -1)
```

```{r, fig.height=15, fig.width=10}
combined_plot <- grid.arrange(plot_Depression_prop, plot_Anxiety_prop, plot_Insomnia_prop, plot_OCD_prop, ncol = 1)
```

Les styles qui se démarquent le mieux sont comme attendu ceux qui possèdent les plus petits échantillons, on a d'abords le latino qui semble être le style le plus corrélé positivement aux différents problèmes mentaux, et à l'opposé on a le Lofi qui semblent être le plus corrélé négativement. Ce qui correspondrait à l'hypothèse de départ, le Lofi étant un style qui se caractérise principalement par sa lenteur et son calme, et le Latino étant un style très dansant. De plus, ces 2 styles sont possiblement les styles présents les plus codifiés dans leur ambiance, pouvant transmettre au final une palette assez restreinte d'émotions. Ceci pourrait expliquer ce que nous voyons, là où les autres styles vont posséder des morceaux ne transmettant pas du tout les même émotions l'un par rapport à l'autre. Mais il est important de garder en tête que l'échantillon Latino n'est composé que de 3 personnes, et Lofi d'une dizaine de personnes, rendant tout ceci très hypothétique.

Ensuite, le Gospel est le style dont les résultats varient le plus d'un problème mental à un autre, étant parfois très corrélé positivement comme avec l'OCD, et parfois très négativement comme avec l'insomnie, sans doute une conséquence de son échantillon de 6 personnes.

Les autres styles, possédant de plus important échantillons, sont plus similaires les uns aux autres. Il n'y pas vraiment de styles qui se démarquent franchement, puisque souvent par exemple si un style possède deux fois plus de niveau 1 que de niveau 2 qu'un autre, ils auront au final la même proportion de personnes avec un niveau inférieur à 2, comme le classique et le country pour la dépression. Ceci pourrait simplement s'expliquer par le fait qu'une division d'un problème mental en 11 niveaux différents est peu pertinent pour une auto-évaluation, l'Homme ayant du mal à voir une différence entre deux niveaux côte-à-côte.

Ainsi, il semble difficile de répondre oui à notre question, surtout que le peu de corrélation que l'on a pu percevoir semble plus être une implication de l'ambiance des morceaux plutôt que des styles à proprement parler. Mais une chose importante que nous n'avons pas pris en compte est le fait qu'avoir un style favori ne signifi pas forcément que l'on écoute beaucoup plus ce style que d'autres. Ce pourrait même parfois être l'inverse. De plus regarder la corélation entre la musique l'intensité des problèmes mentaux ne nous dit rien de si la musique à un impacte positif ou négatif, cela peut au mieux juste nous dit si certains style sont meilleurs pour la santé que d'autres. Il semble donc être plus intéressant de se poser la question "Les styles de musiques peuvent-t-il avoir un impact négatifs ou positifs sur les problèmes mentaux ?".

```{r}

```

```{r}

```
